name: Create Milestones
run-name: Create new milestones for the next two weeks
on:
  push:
    branches:
      - main

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          ref: main

      - name: Get the date of next Wednesday
        id: get-next-wednesday
        run: |
          echo "::set-output name=date::$(TZ=Asia/Seoul date -d 'next wednesday' +%y.%m.%d)"
          echo "::set-output name=iso_date::$(TZ=Asia/Seoul date -d 'next thursday' +%Y-%m-%dT%H:%M:%SZ)"
        shell: bash

      - name: Get the date of the Wednesday after next
        id: get-next-next-wednesday
        run: |
          echo "::set-output name=date::$(TZ=Asia/Seoul date -d '2 weeks next wednesday' +%y.%m.%d)"
          echo "::set-output name=iso_date::$(TZ=Asia/Seoul date -d '2 weeks next thursday' +%Y-%m-%dT%H:%M:%SZ)"
        shell: bash

      - name: "Create a new milestone for next Wednesday"
        id: create-milestone-next
        uses: oinume/create-scheduled-milestone-action@v1.0.0
        with:
          title: ${{ steps.get-next-wednesday.outputs.date }}
          state: "open"
          due_on: ${{ steps.get-next-wednesday.outputs.iso_date }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: "Create a new milestone for the Wednesday after next"
        id: create-milestone-next-next
        uses: oinume/create-scheduled-milestone-action@v1.0.0
        with:
          title: ${{ steps.get-next-next-wednesday.outputs.date }}
          state: "open"
          due_on: ${{ steps.get-next-next-wednesday.outputs.iso_date }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
